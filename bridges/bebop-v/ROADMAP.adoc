// SPDX-License-Identifier: PMPL-1.0-or-later
// SPDX-FileCopyrightText: 2025 Hyperpolymath Contributors
= Bebop-V-FFI Roadmap
:toc: left
:toclevels: 3
:icons: font
:source-highlighter: rouge

> Development roadmap from initial implementation through next-generation hybrid architecture

== Quick Summary

=== Done (v0.0.1)

* [x] ABI contract (`include/bebop_v_ffi.h`) — stable
* [x] V bindings (`v/bebop_bridge.v`) — complete
* [x] Zig build system and stub implementation
* [x] Documentation and white paper
* [x] Schema (`schemas/sensors.bop`)

=== Now

* Implement actual Bebop decode in Zig
* Generate real wire bytes for golden vectors (using `bebopc`)
* Implement encode

=== Next

* CI matrix (Linux/macOS, multiple Zig versions)
* V integration test (link V to Zig .so)
* Rust implementation (plug-compatible; help wanted)

=== Later

* Fuzz tests around decode/encode
* Publish V module packaging guidance
* WASM target for browser/Deno

---

== Detailed Waypoints

This roadmap outlines three major waypoints for Bebop-V-FFI development:

1. **Release** - Core FFI implementation, testing, documentation
2. **Package** - Distribution via package managers, ecosystem integration
3. **Next-Gen Development** - Rust-V-Bebop hybrid architecture

Each waypoint builds on the previous, with clear milestones and success criteria.

---

== Waypoint 1: Release

*Goal*: Stable v1.0.0 release with complete FFI bindings, comprehensive tests, and production-ready documentation.

=== Phase 1.1: Core Implementation

[cols="1,3,1"]
|===
|Status |Task |Priority

|[ ]
|Implement Bebop runtime C wrapper
|P0

|[ ]
|Create V FFI bindings to C layer
|P0

|[ ]
|Implement zero-copy buffer management
|P0

|[ ]
|Add arena allocator for embedded targets
|P1

|[ ]
|Implement endianness handling (little/big)
|P1

|[ ]
|Add bounds checking for all decode operations
|P0
|===

=== Phase 1.2: Code Generation

[cols="1,3,1"]
|===
|Status |Task |Priority

|[ ]
|Create `bebopc` V generator plugin
|P0

|[ ]
|Generate struct definitions from `.bop` schemas
|P0

|[ ]
|Generate encode/decode functions per type
|P0

|[ ]
|Support all Bebop primitive types
|P0

|[ ]
|Support arrays, maps, unions
|P1

|[ ]
|Support message evolution (optional fields)
|P1

|[ ]
|Add `--embed` flag for single-file output
|P2
|===

=== Phase 1.3: Kaldor Integration

[cols="1,3,1"]
|===
|Status |Task |Priority

|[ ]
|Define Kaldor telemetry schemas (`.bop` files)
|P0

|[ ]
|Generate V bindings for Kaldor messages
|P0

|[ ]
|Integrate with ESP32-C6 Matter firmware
|P1

|[ ]
|Test with Kaldor backend (Deno)
|P1

|[ ]
|Validate cross-language wire compatibility
|P0
|===

=== Phase 1.4: Testing & Documentation

[cols="1,3,1"]
|===
|Status |Task |Priority

|[ ]
|Unit tests for all encode/decode operations
|P0

|[ ]
|Property-based tests (fuzzing)
|P1

|[ ]
|Integration tests with real hardware (ESP32-C6)
|P1

|[ ]
|Performance benchmarks vs. raw C
|P2

|[ ]
|API documentation (full coverage)
|P0

|[ ]
|Tutorial: Getting Started guide
|P1

|[ ]
|Tutorial: Kaldor integration guide
|P1
|===

=== Release Criteria

* [ ] All P0 tasks complete
* [ ] 80%+ test coverage
* [ ] Zero memory leaks (Valgrind clean)
* [ ] <20KB compiled library size
* [ ] Benchmarks documented
* [ ] RSR Bronze compliance verified
* [ ] Security review complete

=== Target: v1.0.0

---

== Waypoint 2: Package

*Goal*: Distribute Bebop-V-FFI through standard package managers and integrate with the broader V and IIoT ecosystems.

=== Phase 2.1: V Package Manager (vpkg/vpm)

[cols="1,3,1"]
|===
|Status |Task |Priority

|[ ]
|Create `v.mod` manifest file
|P0

|[ ]
|Register with VPM registry
|P1

|[ ]
|Add install instructions to README
|P0

|[ ]
|Test installation from fresh system
|P1

|[ ]
|Document version compatibility matrix
|P1
|===

=== Phase 2.2: System Packages

[cols="1,3,1"]
|===
|Status |Task |Priority

|[ ]
|Create Guix package definition
|P1

|[ ]
|Create Nix flake
|P2

|[ ]
|Create AUR PKGBUILD (Arch Linux)
|P2

|[ ]
|Create Homebrew formula (macOS)
|P2

|[ ]
|Create Debian/Ubuntu .deb package
|P3
|===

=== Phase 2.3: Ecosystem Integration

[cols="1,3,1"]
|===
|Status |Task |Priority

|[ ]
|Publish Kaldor schemas to central registry
|P1

|[ ]
|Create GitHub Action for schema validation
|P2

|[ ]
|Add to awesome-v and awesome-iiot lists
|P2

|[ ]
|Write blog post / announcement
|P1

|[ ]
|Create demo video
|P2
|===

=== Phase 2.4: CI/CD & Releases

[cols="1,3,1"]
|===
|Status |Task |Priority

|[ ]
|Automated releases via GitLab CI / GitHub Actions
|P1

|[ ]
|Semantic versioning automation
|P1

|[ ]
|CHANGELOG generation
|P1

|[ ]
|Binary artifacts for major platforms
|P2

|[ ]
|Reproducible builds (Guix/Nix)
|P1
|===

=== Package Criteria

* [ ] Available via `vpkg install bebop-v-ffi`
* [ ] Guix package in official channel
* [ ] Nix flake in nixpkgs (or overlay)
* [ ] AUR package available
* [ ] Automated release pipeline
* [ ] Semantic versioning enforced

=== Target: v1.1.0 - v1.x

---

== Waypoint 3: Next-Gen Development (Rust-V-Bebop)

*Goal*: Hybrid architecture combining Rust's safety guarantees with V's simplicity, enabling advanced IIoT patterns.

=== Vision

The next generation of Bebop-V-FFI will introduce a *Rust core* with V bindings, similar to the https://github.com/hyperpolymath/bunsenite[bunsenite] architecture:

[source]
----
┌─────────────────────────────────────────────────────────┐
│                     V Application                        │
│              (ESP32-C6 / RISC-V firmware)               │
└─────────────────────────┬───────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────┐
│                    Zig FFI Layer                         │
│              (Stable C ABI, ~15KB)                       │
└─────────────────────────┬───────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────┐
│                    Rust Core Library                     │
│         (bebop-rs + custom Kaldor extensions)           │
├─────────────────────────────────────────────────────────┤
│  - Zero-copy parsing (verified safe)                    │
│  - Compile-time schema validation                       │
│  - Async encoding for large messages                    │
│  - WASM target for browser/Deno                         │
└─────────────────────────┬───────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────┐
│                   Bebop Wire Format                      │
└─────────────────────────────────────────────────────────┘
----

=== Phase 3.1: Rust Core

[cols="1,3,1"]
|===
|Status |Task |Priority

|[ ]
|Fork/integrate bebop-rs crate
|P0

|[ ]
|Add Kaldor-specific extensions
|P1

|[ ]
|Implement zero-copy views (lifetimes)
|P0

|[ ]
|Add `#![deny(unsafe_code)]` audit
|P0

|[ ]
|WASM target for browser/Deno
|P1

|[ ]
|`no_std` support for bare-metal
|P1
|===

=== Phase 3.2: Zig FFI Layer

[cols="1,3,1"]
|===
|Status |Task |Priority

|[ ]
|Design stable C ABI interface
|P0

|[ ]
|Implement Zig wrapper functions
|P0

|[ ]
|Add error code translation
|P1

|[ ]
|Memory ownership semantics (who frees?)
|P0

|[ ]
|Thread safety guarantees
|P1
|===

=== Phase 3.3: V Bindings (v2)

[cols="1,3,1"]
|===
|Status |Task |Priority

|[ ]
|Update V bindings to use Zig FFI
|P0

|[ ]
|Maintain API compatibility with v1
|P1

|[ ]
|Add async encode/decode support
|P2

|[ ]
|Streaming decode for large messages
|P2

|[ ]
|Compile-time schema embedding
|P2
|===

=== Phase 3.4: Multi-Language Parity

[cols="1,3,1"]
|===
|Status |Task |Priority

|[ ]
|Deno/TypeScript bindings via WASM
|P1

|[ ]
|ReScript bindings (Kaldor frontend)
|P2

|[ ]
|Python bindings (PyO3)
|P3

|[ ]
|Go bindings (CGo)
|P3
|===

=== Phase 3.5: Advanced Features

[cols="1,3,1"]
|===
|Status |Task |Priority

|[ ]
|Schema registry integration
|P2

|[ ]
|Message validation hooks
|P2

|[ ]
|Encryption layer (optional)
|P2

|[ ]
|Compression (LZ4) for large payloads
|P3

|[ ]
|Metrics/tracing integration
|P3
|===

=== Next-Gen Criteria

* [ ] Rust core with zero `unsafe` blocks
* [ ] Zig FFI with stable C ABI
* [ ] V bindings API-compatible with v1
* [ ] WASM support for browser/Deno
* [ ] `no_std` support for bare-metal
* [ ] RSR Silver tier compliance
* [ ] Formal verification (stretch goal)

=== Target: v2.0.0

---

== Timeline

[source]
----
2025 Q1   │ Waypoint 1: Release
          │ ├── Core implementation
          │ ├── Code generation
          │ └── Kaldor integration
          │
2025 Q2   │ Waypoint 1 (cont.) + Waypoint 2: Package
          │ ├── Testing & documentation
          │ ├── v1.0.0 release
          │ ├── VPM registration
          │ └── System packages
          │
2025 Q3   │ Waypoint 2 (cont.)
          │ ├── Ecosystem integration
          │ └── CI/CD automation
          │
2025 Q4   │ Waypoint 3: Next-Gen Development
          │ ├── Rust core development
          │ └── Zig FFI layer
          │
2026 Q1   │ Waypoint 3 (cont.)
          │ ├── V bindings v2
          │ ├── Multi-language parity
          │ └── v2.0.0 release
----

== Success Metrics

=== Adoption

* [ ] 500+ VPM downloads within 6 months
* [ ] 50+ GitHub stars
* [ ] 10+ production deployments (Kaldor nodes)
* [ ] 5+ external contributors

=== Quality

* [ ] 90%+ test coverage
* [ ] <5ms encode latency (1KB message)
* [ ] Zero memory leaks
* [ ] Zero CVEs in first year

=== Ecosystem

* [ ] Integrated into 3+ Kaldor device types
* [ ] Used by 2+ external IIoT projects
* [ ] Featured in V community showcase

== Contributing

Contributions are welcome at all phases! See link:CONTRIBUTING.md[CONTRIBUTING.md] for:

* TPCF perimeter assignments
* Coding standards
* Pull request process

=== Good First Issues

Look for issues labeled:

* `good first issue` - Beginner-friendly tasks
* `help wanted` - Areas where we need community help
* `documentation` - Non-code contributions

== Resources

* https://bebop.sh/guide/[Bebop Documentation]
* https://github.com/vlang/v/blob/master/doc/docs.md[V Language Documentation]
* https://github.com/hyperpolymath/kaldor-iiot[Kaldor IIoT Platform]
* https://github.com/hyperpolymath/bunsenite[Bunsenite] - Reference FFI architecture

---

*Status*: Active Development +
*Last Updated*: 2025-12-24 +
*Next Review*: Monthly

_"Plan the work, work the plan."_
